
<link
  href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css"
  rel="stylesheet"
/>
<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
          <li class="breadcrumb-item"><a href="/posts">Danh sách BĐS</a></li>
          <li class="breadcrumb-item active">Đăng tin mới</li>
        </ol>
      </nav>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-plus me-2"></i>
            Đăng tin bất động sản mới
          </h4>
          <p class="mb-0 mt-2 opacity-75">
            Điền đầy đủ thông tin để tin đăng của bạn được nhiều người quan tâm
          </p>
        </div>

        <div class="card-body">
          <form
            action="/posts"
            method="POST"
            enctype="multipart/form-data"
            class="needs-validation"
            novalidate
          >
            
            <div class="mb-4">
              <h5 class="text-primary mb-3">
                <i class="fas fa-info-circle me-2"></i>
                Thông tin cơ bản
              </h5>

              <div class="mb-3">
                <label for="title" class="form-label">
                  Tiêu đề tin đăng
                  <span class="text-danger">*</span>
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  name="title"
                  placeholder="VD: Bán căn hộ 2PN tại chung cư ABC..."
                  required
                  minlength="10"
                  maxlength="200"
                />
                <div class="invalid-feedback">
                  Tiêu đề phải có từ 10-200 ký tự.
                </div>
                <div class="form-text">
                  Tiêu đề hấp dẫn sẽ thu hút nhiều người xem hơn
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="type" class="form-label">
                    Loại hình
                    <span class="text-danger">*</span>
                  </label>
                  <select class="form-select" id="type" name="type" required>
                    <option value="">Chọn loại hình</option>
                    <option value="bán">Bán</option>
                    <option value="cho thuê">Cho thuê</option>
                  </select>
                  <div class="invalid-feedback">
                    Vui lòng chọn loại hình.
                  </div>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="category" class="form-label">
                    Loại bất động sản
                    <span class="text-danger">*</span>
                  </label>
                  <select
                    class="form-select"
                    id="category"
                    name="category"
                    required
                  >
                    <option value="">Chọn loại BĐS</option>
                    {{#each categories}}
                      <option value="{{name}}">{{name}}</option>
                    {{/each}}
                  </select>
                  <div class="invalid-feedback">
                    Vui lòng chọn loại bất động sản.
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="description" class="form-label">
                  Mô tả chi tiết
                  <span class="text-danger">*</span>
                </label>
                <input type="hidden" name="description" id="description" />
                <div id="editor">
                  <p>Hello World!</p>
                  <p>Some initial <strong>bold</strong> text</p>
                  <p><br /></p>
                </div>
                <div class="invalid-feedback">
                  Mô tả phải có từ 50-2000 ký tự.
                </div>
              </div>
            </div>

            <div class="mb-4">
              <h5 class="text-primary mb-3">
                <i class="fas fa-calculator me-2"></i>
                Giá và diện tích
              </h5>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="price" class="form-label">
                    Giá (VNĐ)
                    <span class="text-danger">*</span>
                  </label>
                  <input
                    type="number"
                    class="form-control"
                    id="price"
                    name="price"
                    placeholder="VD: 2500000000"
                    required
                    min="0"
                    max="999999999999"
                  />
                  <div class="invalid-feedback">
                    Vui lòng nhập giá hợp lệ.
                  </div>
                  <div class="form-text" id="priceDisplay"></div>
                </div>

                <div class="col-md-6 mb-3">
                  <label for="area" class="form-label">
                    Diện tích (m²)
                    <span class="text-danger">*</span>
                  </label>
                  <input
                    type="number"
                    class="form-control"
                    id="area"
                    name="area"
                    placeholder="VD: 75"
                    required
                    min="1"
                    max="10000"
                  />
                  <div class="invalid-feedback">
                    Diện tích phải từ 1-10,000 m².
                  </div>
                  <div class="form-text" id="pricePerSqm"></div>
                </div>
              </div>
            </div>

            <div class="mb-4">
              <h5 class="text-primary mb-3">
                <i class="fas fa-map-marker-alt me-2"></i>
                Địa chỉ và liên hệ
              </h5>

              <div class="mb-3">
                <label for="address" class="form-label">
                  Địa chỉ
                  <span class="text-danger">*</span>
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="address"
                  name="address"
                  placeholder="VD: 123 Đường ABC, Phường XYZ, Quận DEF, TP.HCM"
                  required
                  minlength="10"
                  maxlength="500"
                />
                <div class="invalid-feedback">
                  Địa chỉ phải có từ 10-500 ký tự.
                </div>
              </div>

              <div class="mb-3">
                <label for="phone" class="form-label">
                  Số điện thoại liên hệ
                  <span class="text-danger">*</span>
                </label>
                <input
                  type="tel"
                  class="form-control"
                  id="phone"
                  name="phone"
                  placeholder="VD: 0123456789"
                  required
                  pattern="^[0-9]{10,11}$"
                  value="{{user.phone}}"
                />
                <div class="invalid-feedback">
                  Số điện thoại phải có 10-11 chữ số.
                </div>
              </div>
            </div>

            <div class="mb-4">
              <h5 class="text-primary mb-3">
                <i class="fas fa-images me-2"></i>
                Hình ảnh
              </h5>

              <input
                type="file"
                id="images"
                name="images"
                multiple
                accept="image/*"
              />

              <div class="mt-2 text-muted small">
                <i class="fas fa-info-circle me-1"></i>
                Đã chọn
                <span id="file-count">0</span>
                ảnh
              </div>
            </div>

            <div class="mb-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="terms"
                  name="terms"
                  required
                />
                <label class="form-check-label" for="terms">
                  Tôi xác nhận thông tin trên là chính xác và đồng ý với
                  <a href="/terms" target="_blank">Điều khoản sử dụng</a>
                  <span class="text-danger">*</span>
                </label>
                <div class="invalid-feedback">
                  Vui lòng đồng ý với điều khoản sử dụng.
                </div>
              </div>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="fas fa-paper-plane me-2"></i>
                Đăng tin
              </button>
              <a href="/posts" class="btn btn-outline-secondary btn-lg">
                <i class="fas fa-times me-2"></i>
                Hủy
              </a>
            </div>

            <div class="mt-3">
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Lưu ý:</strong>
                Tin đăng sẽ được kiểm duyệt trước khi hiển thị công khai. Quá
                trình này có thể mất 1-2 ngày làm việc.
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="/js/simple-upload.js"></script>
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>

<script>
  const quill = new Quill('#editor', {
    theme: 'snow'
  });

  // Trước khi submit form, gán nội dung vào hidden input
  const form = document.querySelector('form');
  form.onsubmit = function() {
    // Lấy nội dung HTML của editor
    const description = document.querySelector('input[name=description]');
    description.value = quill.root.innerHTML; // Hoặc quill.getContents() nếu muốn Delta format
  };
</script>